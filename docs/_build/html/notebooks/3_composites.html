<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Composites &mdash; pyWaPOR  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sideloading data" href="4_sideloading.html" />
    <link rel="prev" title="Levels" href="2_levels.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #004747" >
            <a href="../index.html" class="icon icon-home"> pyWaPOR
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../data_sources.html">Data</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_levels.html">Levels</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Composites</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_sideloading.html">Sideloading data</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_enhancers.html">Enhancing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_wapor_vs_pywapor.html">pyWaPOR vs. WaPOR</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_pywapor_api.html">pyWaPOR API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_etlook.html">ETLook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #004747" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyWaPOR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../_user_guide.html">User Guide</a> &raquo;</li>
      <li>Composites</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://bitbucket.org///src/notebooks/3_composites.ipynb?mode=view" class="fa fa-bitbucket"> Edit on Bitbucket</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Composites">
<h1>Composites<a class="headerlink" href="#Composites" title="Permalink to this heading"></a></h1>
<p>In this notebook we’ll take a closer look at how <code class="docutils literal notranslate"><span class="pre">pre_et_look</span></code> works internally. To do so, we’ll be using a couple of functions that you’d normally not need to touch, because they are called automatically when you run <code class="docutils literal notranslate"><span class="pre">pywapor.pre_et_look.main</span></code>.</p>
<p>First, we’ll install pywapor in case it’s not installed yet.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install <span class="nv">pywapor</span><span class="o">==</span><span class="m">2</span>.5.0 --quiet
</pre></div>
</div>
</div>
<p>Then we can define some of the basic parameters, that were explained in the introduction notebook. In this case we’ll look at the Fayoum region again, for a period of two months.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pywapor</span>

<span class="n">project_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;/Users/hmcoerver/pywapor_notebooks_3&quot;</span>
<span class="n">latlim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">28.9</span><span class="p">,</span> <span class="mf">29.7</span><span class="p">]</span>
<span class="n">lonlim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">30.2</span><span class="p">,</span> <span class="mf">31.2</span><span class="p">]</span>
<span class="n">timelim</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2021-06-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2021-08-01&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>One of the first things happening when you run <code class="docutils literal notranslate"><span class="pre">pre_et_look</span></code>, is the creation of a more precise definition of the composites (from here on also referred to as time_bins) for which <code class="docutils literal notranslate"><span class="pre">pre_et_look</span></code> will prepare the data to be used by <code class="docutils literal notranslate"><span class="pre">et_look</span></code>.</p>
<p>The default value for the <code class="docutils literal notranslate"><span class="pre">bin_length</span></code> in <code class="docutils literal notranslate"><span class="pre">pywapor.pre_et_look.main</span></code> is <code class="docutils literal notranslate"><span class="pre">&quot;DEKAD&quot;</span></code>, which creates three composites per month (of roughly 10 days each), just like much of the WaPOR data. We’ll go with this default value for now. The variable <code class="docutils literal notranslate"><span class="pre">bins</span></code> contains the edges off these bins.</p>
<p>Normally you wouldn’t have to run this code yourself, its just shown here to explain what happens inside the <code class="docutils literal notranslate"><span class="pre">pre_et_look</span></code> code.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">bin_length</span> <span class="o">=</span> <span class="s2">&quot;DEKAD&quot;</span>

<span class="n">timelim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">timelim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">timelim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">timelim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">bins</span> <span class="o">=</span> <span class="n">pywapor</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">compositer</span><span class="o">.</span><span class="n">time_bins</span><span class="p">(</span><span class="n">timelim</span><span class="p">,</span> <span class="n">bin_length</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Composite </span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> starts at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> and ends at </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Composite 1 starts at 2021-06-01T00:00:00.000000000 and ends at 2021-06-11T00:00:00.000000000.

Composite 2 starts at 2021-06-11T00:00:00.000000000 and ends at 2021-06-21T00:00:00.000000000.

Composite 3 starts at 2021-06-21T00:00:00.000000000 and ends at 2021-07-01T00:00:00.000000000.

Composite 4 starts at 2021-07-01T00:00:00.000000000 and ends at 2021-07-11T00:00:00.000000000.

Composite 5 starts at 2021-07-11T00:00:00.000000000 and ends at 2021-07-21T00:00:00.000000000.

Composite 6 starts at 2021-07-21T00:00:00.000000000 and ends at 2021-08-01T00:00:00.000000000.

</pre></div></div>
</div>
<p>Besides defining the time_bins, <code class="docutils literal notranslate"><span class="pre">pre_et_look</span></code> also downloads data. In this example we’ll look solely at NDVI data (from MOD13 and MYD13). So instead of using the default (<code class="docutils literal notranslate"><span class="pre">&quot;level_1&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;level_2&quot;</span></code>) <code class="docutils literal notranslate"><span class="pre">sources</span></code>, we’ll define some custom values here. Like this, <code class="docutils literal notranslate"><span class="pre">pre_et_look</span></code> will only process <code class="docutils literal notranslate"><span class="pre">ndvi</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sources</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ndvi&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;products&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;MODIS&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;product_name&#39;</span><span class="p">:</span> <span class="s1">&#39;MOD13Q1.061&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;enhancers&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;is_example&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                          <span class="p">{</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;MODIS&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;product_name&#39;</span><span class="p">:</span> <span class="s1">&#39;MYD13Q1.061&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;enhancers&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">}],</span>
            <span class="s1">&#39;composite_type&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
            <span class="s1">&#39;temporal_interp&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;spatial_interp&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<p>Now we can run <code class="docutils literal notranslate"><span class="pre">pre_et_look</span></code>. Since we’ll only download and process <code class="docutils literal notranslate"><span class="pre">ndvi</span></code>, this should go pretty quick.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">pywapor</span><span class="o">.</span><span class="n">pre_et_look</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">latlim</span><span class="p">,</span> <span class="n">lonlim</span><span class="p">,</span> <span class="n">timelim</span><span class="p">,</span>
                                <span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
&gt; PRE_ET_LOOK
    --&gt; Example dataset is MODIS.MOD13Q1.061.
    --&gt; Collecting `ndvi` from MODIS.MOD13Q1.061.
100%|██████████| 1/1 [00:01&lt;00:00,  1.11s/it]
    --&gt; Applying &#39;mask_qa&#39; to `ndvi`.
    --&gt; Collecting `ndvi` from MODIS.MYD13Q1.061.
100%|██████████| 1/1 [00:01&lt;00:00,  1.11s/it]
    --&gt; Applying &#39;mask_qa&#39; to `ndvi`.
    --&gt; Using `reproject_chunk` on MOD13Q1.061.nc:ndvi (nearest).
    --&gt; Using `reproject_chunk` on MYD13Q1.061.nc:ndvi (nearest).
    --&gt; Compositing `ndvi` (mean).
    --&gt; Applying &#39;rename_vars&#39; to `ndvi`.
    --&gt; Applying &#39;fill_attrs&#39; to `ndvi`.
    --&gt; Applying &#39;lapse_rate&#39; to `ndvi`.
    --&gt; Applying &#39;calc_doys&#39; to `ndvi`.
    --&gt; Applying &#39;add_constants&#39; to `ndvi`.
&lt; PRE_ET_LOOK (0:01:01.304715)
</pre></div></div>
</div>
<p>Next we’ll define a point at which we’re going to have a closer look.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diagnostics</span> <span class="o">=</span> <span class="p">{</span> <span class="c1"># label          # lat      # lon</span>
                <span class="s1">&#39;agriculture&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">29.32301</span><span class="p">,</span> <span class="mf">30.77599</span><span class="p">),</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
<p>Let’s create a map showing this point and the <code class="docutils literal notranslate"><span class="pre">ndvi</span></code> for the first composite.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">qm</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">ndvi</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time_bins</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">qm</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">poi</span><span class="p">,</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span> <span class="ow">in</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">poi</span><span class="p">,</span> <span class="n">edgecolors</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fe3838fa190&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_3_composites_14_1.png" src="../_images/notebooks_3_composites_14_1.png" />
</div>
</div>
<p>Now we run <code class="docutils literal notranslate"><span class="pre">pre_et_look</span></code> with <code class="docutils literal notranslate"><span class="pre">diagnostics</span></code> as an keyword argument. This will run the function for only the pixel(s) we’ve selected (i.e. it will be a lot faster than running the entire domain). It will also create a folder called <code class="docutils literal notranslate"><span class="pre">GRAPHS</span></code> in our <code class="docutils literal notranslate"><span class="pre">project_folder</span></code>, containing the graphs it creates.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pywapor</span><span class="o">.</span><span class="n">pre_et_look</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">latlim</span><span class="p">,</span> <span class="n">lonlim</span><span class="p">,</span> <span class="n">timelim</span><span class="p">,</span> <span class="n">bin_length</span> <span class="o">=</span> <span class="n">bin_length</span><span class="p">,</span>
                            <span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span><span class="p">,</span> <span class="n">diagnostics</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
&gt; PRE_ET_LOOK
    --&gt; Example dataset is MODIS.MOD13Q1.061.
    --&gt; Collecting `ndvi` from MODIS.MOD13Q1.061.
    --&gt; Collecting `ndvi` from MODIS.MYD13Q1.061.
    &gt; DIAGNOSTICS
        --&gt; Using `reproject_chunk` on MOD13Q1.061.nc:ndvi (nearest).
        --&gt; Using `reproject_chunk` on MYD13Q1.061.nc:ndvi (nearest).
        --&gt; Compositing `ndvi` (mean) (diagnostic).
        --&gt; Creating graph for `ndvi`.
    &lt; DIAGNOSTICS (0:00:07.180040)
&lt; PRE_ET_LOOK (0:00:07.270527)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_3_composites_16_1.png" src="../_images/notebooks_3_composites_16_1.png" />
</div>
</div>
<p>In the graph we have just created, you should see a couple of things. First of all, there are red-stars and green-dots that show available NDVI measurements at our POI, coming from MOD13 and MYD13 respectively. Then there are blue bars that show the composite pixel values at this location. Since our composites are dekadal, the width of the bars is about 10 days (check the x-axis).</p>
<p>Each composite value is the mean of the available measurements within the respective time_bin. For example, most of the bars match with some of the red-stars or green-dots. While the first bar, ranging from June 1st till June 11th is exactly in between two measurements, i.e. it’s the mean of the two available measurements.</p>
<p>The composite type is defined using the keyword <code class="docutils literal notranslate"><span class="pre">composite_type</span></code> in the <code class="docutils literal notranslate"><span class="pre">sources</span></code> variable. Possible values are <code class="docutils literal notranslate"><span class="pre">&quot;mean&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;min&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;max&quot;</span></code>.</p>
<p>Now let’s adjust our <code class="docutils literal notranslate"><span class="pre">composite_length</span></code> to create 6-day composites (instead of dekadal) and see what happens.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bin_length</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">bins</span> <span class="o">=</span> <span class="n">pywapor</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">compositer</span><span class="o">.</span><span class="n">time_bins</span><span class="p">(</span><span class="n">timelim</span><span class="p">,</span> <span class="n">bin_length</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Composite </span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> starts at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> and ends at </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Composite 1 starts at 2021-06-01T00:00:00.000000000 and ends at 2021-06-07T00:00:00.000000000.

Composite 2 starts at 2021-06-07T00:00:00.000000000 and ends at 2021-06-13T00:00:00.000000000.

Composite 3 starts at 2021-06-13T00:00:00.000000000 and ends at 2021-06-19T00:00:00.000000000.

Composite 4 starts at 2021-06-19T00:00:00.000000000 and ends at 2021-06-25T00:00:00.000000000.

Composite 5 starts at 2021-06-25T00:00:00.000000000 and ends at 2021-07-01T00:00:00.000000000.

Composite 6 starts at 2021-07-01T00:00:00.000000000 and ends at 2021-07-07T00:00:00.000000000.

Composite 7 starts at 2021-07-07T00:00:00.000000000 and ends at 2021-07-13T00:00:00.000000000.

Composite 8 starts at 2021-07-13T00:00:00.000000000 and ends at 2021-07-19T00:00:00.000000000.

Composite 9 starts at 2021-07-19T00:00:00.000000000 and ends at 2021-07-25T00:00:00.000000000.

Composite 10 starts at 2021-07-25T00:00:00.000000000 and ends at 2021-07-31T00:00:00.000000000.

Composite 11 starts at 2021-07-31T00:00:00.000000000 and ends at 2021-08-06T00:00:00.000000000.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pywapor</span><span class="o">.</span><span class="n">pre_et_look</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">latlim</span><span class="p">,</span> <span class="n">lonlim</span><span class="p">,</span> <span class="n">timelim</span><span class="p">,</span> <span class="n">bin_length</span> <span class="o">=</span> <span class="n">bin_length</span><span class="p">,</span>
                            <span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span><span class="p">,</span> <span class="n">diagnostics</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
&gt; PRE_ET_LOOK
    --&gt; Example dataset is MODIS.MOD13Q1.061.
    --&gt; Collecting `ndvi` from MODIS.MOD13Q1.061.
    --&gt; Collecting `ndvi` from MODIS.MYD13Q1.061.
    &gt; DIAGNOSTICS
        --&gt; Using `reproject_chunk` on MOD13Q1.061.nc:ndvi (nearest).
        --&gt; Using `reproject_chunk` on MYD13Q1.061.nc:ndvi (nearest).
        --&gt; Compositing `ndvi` (mean) (diagnostic).
        --&gt; Creating graph for `ndvi`.
    &lt; DIAGNOSTICS (0:00:07.295356)
&lt; PRE_ET_LOOK (0:00:07.342995)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_3_composites_20_1.png" src="../_images/notebooks_3_composites_20_1.png" />
</div>
</div>
<p>In the new graph, you’ll see that the blue bars have become smaller (i.e. less wide), since our time_bins are now shorter. As a result, some composites could not be created, because no NDVI measurements were available during that respective epoch. For example, the fourth composite (ranging between 2021-06-19 00:00:00 and 2021-06-25 00:00:00) is missing.</p>
<p>We solve this by applying a temporal interpolation between the available measurements. This is especially suitable for this data, because the MOD13 and MYD13 datasets itself are 16-daily composites, i.e. their measurements can be considered valid for a 16-day period.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sources</span><span class="p">[</span><span class="s2">&quot;ndvi&quot;</span><span class="p">][</span><span class="s2">&quot;temporal_interp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

<span class="n">pywapor</span><span class="o">.</span><span class="n">pre_et_look</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">latlim</span><span class="p">,</span> <span class="n">lonlim</span><span class="p">,</span> <span class="n">timelim</span><span class="p">,</span> <span class="n">bin_length</span> <span class="o">=</span> <span class="n">bin_length</span><span class="p">,</span>
                            <span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span><span class="p">,</span> <span class="n">diagnostics</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
&gt; PRE_ET_LOOK
    --&gt; Example dataset is MODIS.MOD13Q1.061.
    --&gt; Collecting `ndvi` from MODIS.MOD13Q1.061.
    --&gt; Collecting `ndvi` from MODIS.MYD13Q1.061.
    &gt; DIAGNOSTICS
        --&gt; Using `reproject_chunk` on MOD13Q1.061.nc:ndvi (nearest).
        --&gt; Using `reproject_chunk` on MYD13Q1.061.nc:ndvi (nearest).
        --&gt; Compositing `ndvi` (mean) (diagnostic).
        --&gt; Creating graph for `ndvi`.
    &lt; DIAGNOSTICS (0:00:07.707073)
&lt; PRE_ET_LOOK (0:00:07.749995)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_3_composites_23_1.png" src="../_images/notebooks_3_composites_23_1.png" />
</div>
</div>
<p>The two composites that were previously missing are now there! You can see that interpolation points (in black) have appeared in the graph. Note that although here we are looking at one pixel, these interpolations are done for the entire domain.</p>
<p>Possible values for temporal_interp are <code class="docutils literal notranslate"><span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;linear&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;nearest&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;zero&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;slinear&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;quadratic&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;cubic&quot;</span></code>. But be aware that some of these can be computationally heavy, as you can see when combining a cubic <code class="docutils literal notranslate"><span class="pre">temporal_interp</span></code> with a percentile <code class="docutils literal notranslate"><span class="pre">composite_type</span></code>.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="2_levels.html" class="btn btn-neutral float-left" title="Levels" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="4_sideloading.html" class="btn btn-neutral float-right" title="Sideloading data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, FAO.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>